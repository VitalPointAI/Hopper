name = "hopper-license-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# Cron Triggers for recurring subscription processing
# Runs daily at 6 AM UTC to process due crypto subscriptions
[triggers]
crons = ["0 6 * * *"]

# KV Namespace bindings (production)
[[kv_namespaces]]
binding = "PROCESSED_EVENTS"
id = "e2a32f00864d41369d77d0160db950d7"

[[kv_namespaces]]
binding = "SUBSCRIPTIONS"
id = "ab2b417d9e5b4b3c92abc9efc0c063fa"

[[kv_namespaces]]
binding = "CRYPTO_SUBSCRIPTIONS"
id = "c161852936364f3d809fa0826215eb4d"

[[kv_namespaces]]
binding = "TELEMETRY"
id = "a539a15f0b8d42c19f52e1750837cecb"

[[kv_namespaces]]
binding = "USER_LICENSES"
id = "b85c3c3954f54412ac7bbfd41dca9f4d"

# Environment variables (non-secret)
[vars]
NEAR_RPC_URL = "https://rpc.mainnet.fastnear.com"
LICENSE_DURATION_DAYS = "30"
CRYPTO_MONTHLY_USD = "4.00"
NEAR_INTENTS_API_URL = "https://1click.chaindefuser.com"
SETTLEMENT_ACCOUNT = "vitalpointai.near"
# Set to contract admin account (e.g., specflow.testnet or admin.specflow.near)
ADMIN_WALLET = "specflow.near"

# Secrets (set with: wrangler secret put <NAME>)
# STRIPE_SECRET_KEY - Stripe API key
# STRIPE_WEBHOOK_SECRET - Stripe webhook signing secret
# STRIPE_PRICE_ID - Stripe price ID for subscription
# NEAR_PRIVATE_KEY - NEAR account private key for signing transactions
# LICENSE_CONTRACT_ID - NEAR contract account ID (mainnet: license.specflow.near)
# NEAR_NETWORK - "mainnet" or "testnet"
# FASTNEAR_API_KEY - FastNEAR API key for RPC access
# NEAR_INTENTS_API_KEY - NEAR Intents 1Click API key for subscription processing
# ADMIN_SECRET - Secret key for signing admin JWT tokens
# GOOGLE_CLIENT_ID - Google OAuth 2.0 client ID
# GOOGLE_CLIENT_SECRET - Google OAuth 2.0 client secret
# GITHUB_CLIENT_ID - GitHub OAuth App client ID
# GITHUB_CLIENT_SECRET - GitHub OAuth App client secret
