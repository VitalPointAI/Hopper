---
phase: 05.1-gsd-parity
plan: 03-FIX
type: fix
---

<objective>
Fix 2 UAT issues from plan 05.1-03.

Source: 05.1-03-ISSUES.md
Priority: 0 critical, 1 major, 1 minor

Purpose: Make /verify-work buttons functional and improve UX with interactive test flow.
Output: Working verify-work command with proper button handlers and interactive testing.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/05.1-gsd-parity/05.1-03-ISSUES.md

**Original plan for reference:**
@.planning/phases/05.1-gsd-parity/05.1-03-PLAN.md

**Current implementation:**
@src/chat/commands/verifyWork.ts
@src/extension.ts
@package.json
</context>

<tasks>
<task type="auto">
  <name>Fix UAT-001: Register verifyWorkResult command</name>
  <files>src/extension.ts, package.json</files>
  <action>
The buttons in verify-work use command `hopper.verifyWorkResult` but this command is never registered.

1. In package.json, add to contributes.commands:
   ```json
   {
     "command": "hopper.verifyWorkResult",
     "title": "Hopper: Report UAT Result"
   }
   ```

2. In extension.ts, register the command that:
   - Takes arguments: [phase, plan, phaseDir, resultType]
   - For 'all-pass': Shows info message "All tests passed for Phase X Plan Y"
   - For 'has-issues': Opens an input dialog to collect issue details, then calls handleVerifyWorkResult

3. Import handleVerifyWorkResult from verifyWork.ts

Note: The existing handleVerifyWorkResult function expects issues as a parameter but buttons can't pass complex data. The command handler needs to collect issue info via input dialogs.
  </action>
  <verify>
1. Build extension: npm run compile
2. Run extension in debug mode
3. Type `@hopper /verify-work`
4. Click "All Tests Pass" button - should show message
5. Click "Report Issues" button - should open input dialog
  </verify>
  <done>Both buttons respond when clicked with appropriate actions</done>
</task>

<task type="auto">
  <name>Fix UAT-002: Implement interactive test guidance flow</name>
  <files>src/chat/commands/verifyWork.ts</files>
  <action>
Redesign verify-work to guide tests one-by-one instead of presenting a static checklist.

Current approach: Shows all tests at once, summary buttons at end.
New approach: Present one test at a time with per-test result buttons.

Implementation:
1. After generating test checklist, present first test item with buttons:
   - "Pass" - Mark test passed, show next test
   - "Fail" - Prompt for severity and description, then next test
   - "Partial" - Prompt for issue details, then next test
   - "Skip" - Mark skipped, show next test

2. Use vscode.window.showQuickPick for test result selection:
   ```typescript
   const result = await vscode.window.showQuickPick(
     ['Pass', 'Fail', 'Partial', 'Skip'],
     { placeHolder: `Test ${i+1}: ${testItem}` }
   );
   ```

3. When "Fail" or "Partial" selected, use showInputBox for details:
   - Prompt for severity (showQuickPick: Blocker/Major/Minor/Cosmetic)
   - Prompt for description (showInputBox)

4. Track results as tests complete:
   - Store in array of TestResult objects
   - When all tests done, show summary and offer to log issues

5. At end, present summary:
   - Passed: X
   - Failed: Y (with severities)
   - Partial: Z
   - Skipped: W
   - Buttons: "Log Issues and Continue" or "Done"

Note: VSCode Chat API doesn't support multi-turn interaction within a single command response. Use vscode.window dialogs (showQuickPick, showInputBox) instead of stream.button for the interactive flow. The chat response shows progress/status updates while dialogs handle user input.
  </action>
  <verify>
1. Type `@hopper /verify-work`
2. Observe QuickPick appears for first test
3. Select a result (Pass/Fail/etc)
4. If Fail: Confirm severity and description prompts appear
5. Continue through all tests
6. Verify summary shows at end with correct counts
  </verify>
  <done>User is guided through tests one-by-one with per-test reporting, issues collected and logged</done>
</task>
</tasks>

<verification>
Before declaring plan complete:
- [ ] Extension compiles without errors (npm run compile)
- [ ] No TypeScript errors
- [ ] verify-work command works end-to-end with interactive flow
- [ ] Issues are logged to phase-scoped ISSUES.md when tests fail
- [ ] Both "All Tests Pass" and "Report Issues" paths work
</verification>

<success_criteria>
- All UAT issues from 05.1-03-ISSUES.md addressed
- Buttons respond to clicks
- Interactive test flow guides user through each test
- Tests pass
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-gsd-parity/05.1-03-FIX-SUMMARY.md`
</output>
