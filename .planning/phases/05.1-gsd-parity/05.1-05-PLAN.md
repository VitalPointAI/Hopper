---
phase: 05.1-gsd-parity
plan: 05
type: execute
---

<objective>
Implement live discovery command for real-time documentation verification.

Purpose: Enable /discovery-phase to fetch current library documentation using web search and official docs, ensuring plans are based on up-to-date information rather than potentially stale LLM knowledge.
Output: Working /discovery-phase command with web search and documentation fetching.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Key patterns:**
- LLM for analysis (03-01, 03-03)
- Existing /research-phase implementation for comparison
- Web search integration needed
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create discovery-phase command</name>
  <files>src/chat/commands/discoveryPhase.ts</files>
  <action>
Create /discovery-phase command that supports three depth levels:

**Level 1 - Quick Verify (depth=verify):**
- Confirms single library/framework syntax and version are current
- Uses web search to verify against official docs
- No file output, just verbal confirmation to proceed

**Level 2 - Standard Discovery (depth=standard):**
- Compares 2-4 options for a technical choice
- Fetches official documentation for each option
- Searches for "{option A} vs {option B} 2026"
- Creates DISCOVERY.md with recommendation

**Level 3 - Deep Dive (depth=deep):**
- Exhaustive research for architectural decisions
- Multiple web searches and doc fetches
- Cross-verifies all findings
- Creates comprehensive DISCOVERY.md with confidence levels

**Command signature:**
/discovery-phase [phase-number] [--depth=verify|standard|deep]

Default depth is "standard" if not specified.

**Implementation:**
1. Parse phase number and depth argument
2. Load phase from ROADMAP.md to understand context
3. Based on depth, execute appropriate research:
   - Use VSCode's built-in web search if available
   - Fetch official documentation URLs
   - Cross-reference multiple sources
4. Generate DISCOVERY.md in phase directory (Level 2-3)
5. Stream progress as research proceeds
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Discovery-phase command implements all three depth levels</done>
</task>

<task type="auto">
  <name>Task 2: Implement web documentation fetching</name>
  <files>src/chat/commands/discoveryPhase.ts, src/utils/webFetch.ts</files>
  <action>
Create utility for fetching and parsing documentation:

1. Create src/utils/webFetch.ts:
   - fetchDocumentation(url: string): Promise<string>
   - Uses fetch API to get page content
   - Strips HTML, extracts relevant content
   - Handles common doc site formats (MDN, npm, GitHub, official docs)

2. Integrate with discovery-phase:
   - For known libraries, construct official doc URLs
   - Fetch and parse relevant sections
   - Include code examples when available

3. Web search integration:
   - Use simple search query construction
   - Parse search results for relevant links
   - Fetch top results for cross-verification
  </action>
  <verify>Can fetch and parse documentation from npm, GitHub, and MDN</verify>
  <done>Web documentation fetching works for common sources</done>
</task>

<task type="auto">
  <name>Task 3: Register command and integrate with plan-phase</name>
  <files>src/chat/commands/index.ts, src/chat/commands/planPhase.ts</files>
  <action>
In index.ts:
1. Import handleDiscoveryPhase from './discoveryPhase'
2. Add to COMMAND_DEFINITIONS:
   - { name: 'discovery-phase', description: 'Research current documentation before planning' }
3. Register handler

In planPhase.ts:
1. Before generating plan, check if phase needs discovery:
   - New external integration → suggest discovery
   - Technology choice → suggest discovery
2. If DISCOVERY.md exists for phase, include findings in plan context
3. Note in plan when discovery was used vs skipped

This makes plan-phase discovery-aware.
  </action>
  <verify>npm run compile succeeds, plan-phase suggests discovery when appropriate</verify>
  <done>Discovery integrated with planning workflow</done>
</task>

<task type="auto">
  <name>Task 4: Create DISCOVERY.md template and output</name>
  <files>src/chat/commands/discoveryPhase.ts</files>
  <action>
Implement DISCOVERY.md generation with this structure:

```markdown
# Discovery: [Phase Name]

**Date:** [timestamp]
**Depth:** [verify|standard|deep]
**Confidence:** [HIGH|MEDIUM|LOW]

## Summary

[One paragraph recommendation]

## Key Findings

### [Topic 1]
**Source:** [URL]
**Finding:** [What we learned]
**Code Example:**
```[language]
[example from docs]
```

### [Topic 2]
...

## Comparison (if multiple options)

| Criteria | Option A | Option B |
|----------|----------|----------|
| [criteria] | [value] | [value] |

## Recommendation

[Final recommendation with rationale]

## Open Questions

- [Any unresolved questions]

## Sources

1. [URL 1] - [what it provided]
2. [URL 2] - [what it provided]
```

Write to `.planning/phases/XX-name/DISCOVERY.md`
  </action>
  <verify>Generated DISCOVERY.md follows template structure</verify>
  <done>DISCOVERY.md output matches expected format</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] `/discovery-phase` with depth=verify confirms library info
- [ ] `/discovery-phase` with depth=standard creates DISCOVERY.md
- [ ] `/discovery-phase` with depth=deep creates comprehensive DISCOVERY.md
- [ ] Web documentation fetching works for npm, GitHub, MDN
- [ ] /plan-phase loads DISCOVERY.md when available
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Live documentation fetching works
- Discovery integrates with planning workflow
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-gsd-parity/05.1-05-SUMMARY.md`

Document:
- Depth levels implemented
- Documentation sources supported
- Integration with plan-phase
</output>
