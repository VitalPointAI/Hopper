---
phase: 05.1-gsd-parity
plan: 01
type: execute
---

<objective>
Implement phase management commands: /add-phase, /insert-phase, /remove-phase.

Purpose: Enable dynamic roadmap modification - adding phases to end, inserting urgent phases between existing ones, and removing phases.
Output: Working phase manipulation commands that update ROADMAP.md correctly.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**GSD references:**
@~/.claude/commands/gsd/add-phase.md - Add phase to end
@~/.claude/commands/gsd/insert-phase.md - Insert urgent phase with decimal numbering
@~/.claude/commands/gsd/remove-phase.md - Remove phase and renumber

**Key patterns:**
- ROADMAP.md parsing (from /create-roadmap)
- File writing via workspace API
- LLM for content generation (03-01)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create add-phase command</name>
  <files>src/chat/commands/addPhase.ts</files>
  <action>
Create /add-phase command that:

1. Accepts phase description as argument (required)
2. Parses ROADMAP.md to find:
   - Current highest phase number
   - Milestone structure (if multi-milestone project)
3. Generates new phase entry with:
   - Next sequential number
   - Name from user description
   - Goal, dependencies (previous phase), research flag
   - Empty Plans section with TBD
4. Appends to ROADMAP.md in correct location (before ## Progress section)
5. Updates ## Progress table with new row
6. Commits change: "docs(roadmap): add Phase {N} - {name}"

If no argument provided, prompt user for phase description.
Use LLM to generate proper goal/description from user input.
  </action>
  <verify>TypeScript compiles without errors</verify>
  <done>Add-phase handler creates new phase at end of roadmap</done>
</task>

<task type="auto">
  <name>Task 2: Create insert-phase command</name>
  <files>src/chat/commands/insertPhase.ts</files>
  <action>
Create /insert-phase command that:

1. Accepts arguments: after-phase-number and description
   - Example: /insert-phase 3 "Fix critical auth bug"
2. Validates:
   - Integer phase N exists and is complete
   - Integer phase N+1 exists in roadmap
   - Decimal phase N.Y doesn't already exist (find next available Y)
3. Generates decimal phase (e.g., 3.1, 3.2):
   - Marked as INSERTED
   - Depends on phase N
   - Goal from user description
4. Inserts in correct position in ROADMAP.md (after N, before N+1)
5. Updates ## Progress table with new row
6. Creates phase directory: .planning/phases/0N.Y-name/
7. Commits: "docs(roadmap): insert Phase {N.Y} - {name} (URGENT)"

Decimal phases enable urgent work insertion without renumbering.
  </action>
  <verify>TypeScript compiles, decimal phases insert correctly</verify>
  <done>Insert-phase creates decimal phases between existing ones</done>
</task>

<task type="auto">
  <name>Task 3: Create remove-phase command and register all</name>
  <files>src/chat/commands/removePhase.ts, src/chat/commands/index.ts</files>
  <action>
Create /remove-phase command that:

1. Accepts phase number to remove (required)
2. Validates phase exists and is NOT complete (can't remove completed work)
3. For integer phases:
   - Warn about dependent phases
   - Offer to remove or renumber subsequent phases
4. For decimal phases:
   - Simpler removal (no renumbering needed)
5. Updates ROADMAP.md:
   - Removes phase entry
   - Renumbers if needed (integer phases)
   - Updates ## Progress table
6. Removes phase directory if empty (no plans created)
7. Commits: "docs(roadmap): remove Phase {N} - {name}"

In index.ts:
1. Import all three handlers
2. Add to COMMAND_DEFINITIONS:
   - { name: 'add-phase', description: 'Add a new phase to end of roadmap' }
   - { name: 'insert-phase', description: 'Insert urgent phase between existing phases' }
   - { name: 'remove-phase', description: 'Remove a phase from roadmap' }
3. Register all handlers

Update /help output.
  </action>
  <verify>npm run compile succeeds, all three commands work</verify>
  <done>Phase management commands fully functional</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] `/add-phase "Test phase"` adds Phase 6 to end of roadmap
- [ ] `/insert-phase 5 "Urgent fix"` creates Phase 5.1
- [ ] `/remove-phase` validates phase state before removal
- [ ] ROADMAP.md updates correctly for all operations
- [ ] Git commits created for each operation
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Phase manipulation matches GSD framework
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-gsd-parity/05.1-01-SUMMARY.md`
</output>
