---
phase: 01.5-licensing
plan: 03-FIX
type: fix
tags: [near-intents, bugfix]

key-files:
  modified:
    - workers/license-api/src/services/near-intents.ts

issues-resolved:
  - UAT-001
  - UAT-002

# Metrics
duration: 8min
completed: 2026-01-13
---

# Plan 03-FIX: NEAR Intents API Compatibility Fixes

**Fixed depositType and asset ID format issues for NEAR Intents 1Click API**

## Performance

- **Duration:** 8 min
- **Started:** 2026-01-13T21:56:09Z
- **Completed:** 2026-01-13T22:04:00Z
- **Tasks:** 2
- **Files modified:** 1

## Issues Resolved

### UAT-001: Subscribe endpoint fails with depositType mismatch

**Root Cause:** The NEAR Intents 1Click API requires `depositType: INTENTS` when using `swapType: ANY_INPUT`. The code was using `depositType: ORIGIN_CHAIN`.

**Fix Applied:** Changed line 70 in `workers/license-api/src/services/near-intents.ts`:
```typescript
// Before
depositType: QuoteRequest.depositType.ORIGIN_CHAIN

// After
depositType: QuoteRequest.depositType.INTENTS
```

**Commit:** `6e1129f`

### UAT-002: Subscribe endpoint fails with invalid tokenIn

**Root Cause:** The NEAR Intents 1Click API requires asset IDs in `nep141:` format. The code was using `chain:contract` format which is not recognized.

**Fix Applied:** Updated asset ID constants in `workers/license-api/src/services/near-intents.ts`:
```typescript
// Before
const USDC_NEAR_ASSET_ID = 'near:mainnet:usdc.tether-token.near';
const USDC_BASE_ASSET_ID = 'base:0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913';

// After (from /v0/tokens API)
const USDC_NEAR_ASSET_ID = 'nep141:17208628f84f5d6ad33f0da3bbbeb27ffcb398eac501a31bd6ad2011e36133a1';
const USDC_BASE_ASSET_ID = 'nep141:base-0x833589fcd6edb6e08f4c7c32d4f71b54bda02913.omft.near';
```

**Commit:** `c625804`

## Verification

- TypeScript compiles without errors
- Asset IDs verified against `https://1click.chaindefuser.com/v0/tokens`
- Ready for re-verification with `/gsd:verify-work 01.5-03`

## Sources

- [NEAR Intents 1Click API Docs](https://docs.near-intents.org/near-intents/integration/distribution-channels/1click-api)
- [1Click Token List API](https://1click.chaindefuser.com/v0/tokens)

---
*Phase: 01.5-licensing*
*Completed: 2026-01-13*
