---
phase: 01.5-licensing
plan: 01-FIX
subsystem: licensing
tags: [near, rust, cargo-near, wasm, build-config]

# Dependency graph
requires:
  - phase: 01.5-01
    provides: NEAR license contract
provides:
  - Working cargo near build configuration
  - Bulk memory workaround for Rust 1.82+
affects: [01.5-02, 01.5-03, 01.5-04]

# Tech tracking
tech-stack:
  added: []
  patterns: [RUSTFLAGS for wasm32 bulk memory disable]

key-files:
  created: [contracts/license/.cargo/config.toml]
  modified: [contracts/license/Cargo.toml]

key-decisions:
  - "Use RUSTFLAGS=-C target-feature=-bulk-memory for cargo-near < 0.16.0 compatibility"

issues-created: []

# Metrics
duration: 30min
completed: 2026-01-13
---

# Phase 1.5 Plan 01-FIX: cargo near build Fix Summary

**Fixed bulk memory validation errors by disabling Rust 1.82+ bulk memory operations via RUSTFLAGS for cargo-near compatibility**

## Performance

- **Duration:** 30 min
- **Started:** 2026-01-13T00:13:51Z
- **Completed:** 2026-01-13T00:44:40Z
- **Tasks:** 1
- **Files modified:** 2

## Accomplishments

- Diagnosed root cause: Rust 1.82+ LLVM 20 generates bulk memory ops by default
- Created `.cargo/config.toml` with rustflags for standard cargo builds
- Documented workaround for cargo-near with RUSTFLAGS environment variable
- Added reproducible build configuration for future cargo-near 0.16.0+ upgrade
- All tests still pass, WASM artifact builds successfully (118KB)

## Task Commits

1. **Task 1: Fix cargo near build validation errors** - `5d3cc5f` (fix)

**Plan metadata:** (this commit) (docs: complete fix plan)

## Files Created/Modified

- `contracts/license/.cargo/config.toml` - Rustflags configuration for wasm32 target, disables bulk memory
- `contracts/license/Cargo.toml` - Added build documentation and reproducible build metadata

## Decisions Made

- Used `-C target-feature=-bulk-memory` rustflag rather than upgrading cargo-near (missing libudev dependency)
- Added documentation for future upgrade path to cargo-near 0.16.0+ with Docker reproducible builds

## Deviations from Plan

None - fix applied as planned with additional documentation for upgrade path.

## Issues Encountered

- cargo-near 0.16.0 installation failed due to missing libudev.so dependency
- Worked around by using RUSTFLAGS approach instead

## UAT Issue Resolution

### UAT-001: RESOLVED

**Issue:** cargo near build fails with bulk memory validation errors
**Resolution:** Disabled bulk memory operations via RUSTFLAGS
**Verification:** `cargo near build non-reproducible-wasm --env 'RUSTFLAGS=-C target-feature=-bulk-memory'` succeeds
**WASM checksum:** 8e54eaf185d3fbc5fcf39493c5e151814c7ff0aa9cf85f8ac2d82482f80ed1c6

## Next Phase Readiness

- Contract now builds correctly with cargo-near
- Ready for deployment to testnet
- Ready for 01.5-02 (Stripe integration)

---
*Phase: 01.5-licensing*
*Completed: 2026-01-13*
