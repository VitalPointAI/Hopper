---
phase: 02-chat-participant
plan: 01-FIX3
type: fix
---

<objective>
Fix 1 UAT issue from plan 02-01 re-verification.

Source: 02-01-ISSUES.md
Priority: 1 major (UAT-004), 0 blocker, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/02-chat-participant/02-01-ISSUES.md

**Key source files:**
@src/chat/specflowParticipant.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove upfront license check from chat participant</name>
  <files>src/chat/specflowParticipant.ts</files>
  <action>
Remove the upfront `checkPhaseAccess(2, ...)` call that gates the entire chat participant.

The current code at lines 43-64:
```typescript
// Check license for Phase 2+ access (quiet mode - we handle UX in chat)
const hasAccess = await checkPhaseAccess(2, licenseValidator, context, { quiet: true });

if (!hasAccess) {
  // ... shows upgrade message
}
```

**Remove this entire block.** Basic chat should work for everyone. License gating will be implemented per-command in plan 02-02 (Slash command routing infrastructure) where we can gate specific commands like /execute-plan and /plan-phase while keeping basic chat free.

The chat participant should simply:
1. Accept the message
2. Forward to the model
3. Stream the response

No license check at this level.
  </action>
  <verify>npm run compile succeeds</verify>
  <done>Chat participant handler no longer checks license upfront</done>
</task>

<task type="auto">
  <name>Task 2: Update follow-up provider for unlicensed flow</name>
  <files>src/chat/specflowParticipant.ts</files>
  <action>
Since we're removing the license check, the 'license-required' lastCommand case is no longer needed.

Update the followupProvider to remove the license-required case:

```typescript
participant.followupProvider = {
  provideFollowups(
    result: ISpecflowResult,
    _context: vscode.ChatContext,
    _token: vscode.CancellationToken
  ): vscode.ChatFollowup[] {
    return [
      { prompt: '/help', label: 'Show commands' },
      { prompt: '/progress', label: 'Check progress' }
    ];
  }
};
```

The license-required follow-up will be added back in 02-02 when we implement per-command gating.
  </action>
  <verify>npm run compile succeeds</verify>
  <done>Follow-up provider simplified, license-required case removed</done>
</task>

<task type="auto">
  <name>Task 3: Remove unused imports if any</name>
  <files>src/chat/specflowParticipant.ts</files>
  <action>
Check if `checkPhaseAccess` import is still needed after removing the upfront check.

If not used elsewhere in the file, remove the import:
```typescript
import { checkPhaseAccess } from '../licensing/phaseGate';
```

Also check if `licenseValidator` parameter is still needed in `createSpecflowParticipant`. If not used, keep it for now as it will be needed in 02-02 for per-command gating.
  </action>
  <verify>npm run compile succeeds without unused import warnings</verify>
  <done>Imports cleaned up, no unused imports</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] Extension loads in Extension Development Host (F5)
- [ ] @specflow responds to messages WITHOUT showing upgrade prompt
- [ ] Basic chat works: `@specflow hello` returns a model response
- [ ] No license check happens during basic conversation
</verification>

<success_criteria>
- UAT-004 from 02-01-ISSUES.md addressed
- Chat participant works without license check
- Basic conversations are free for all users
- Follow-up suggestions simplified
- Ready for 02-02 to add per-command license gating
</success_criteria>

<output>
After completion, create `.planning/phases/02-chat-participant/02-01-FIX3-SUMMARY.md`
</output>
