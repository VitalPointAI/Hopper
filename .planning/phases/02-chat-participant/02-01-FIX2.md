---
phase: 02-chat-participant
plan: 01-FIX2
type: fix
---

<objective>
Fix 1 UAT issue from plan 02-01 re-verification.

Source: 02-01-ISSUES.md
Priority: 0 blocker, 1 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/02-chat-participant/02-01-ISSUES.md

**Key source files:**
@src/licensing/phaseGate.ts
@src/chat/specflowParticipant.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add quiet mode to checkPhaseAccess for chat participant use</name>
  <files>src/licensing/phaseGate.ts</files>
  <action>
Modify `checkPhaseAccess` to accept an optional `options` parameter with a `quiet` flag:

```typescript
interface CheckPhaseAccessOptions {
  quiet?: boolean; // If true, don't show modal dialogs - just return result
}

export async function checkPhaseAccess(
  phaseNumber: number,
  validator: LicenseValidator,
  context: vscode.ExtensionContext,
  options?: CheckPhaseAccessOptions
): Promise<boolean> {
```

When `options?.quiet` is true:
- Don't show `vscode.window.showWarningMessage` for authentication
- Don't show `UpgradeModalPanel.show` for non-licensed users
- Simply return `false` to let the caller handle the UX

This allows the chat participant to use `checkPhaseAccess(2, validator, context, { quiet: true })` and handle the upgrade prompt in-chat instead of via modal dialogs.
  </action>
  <verify>npm run compile succeeds</verify>
  <done>checkPhaseAccess has quiet mode option that skips modal dialogs</done>
</task>

<task type="auto">
  <name>Task 2: Update chat participant to use quiet mode</name>
  <files>src/chat/specflowParticipant.ts</files>
  <action>
Update the chat handler to use quiet mode:

```typescript
// Check license for Phase 2+ access (quiet mode - we handle UX in chat)
const hasAccess = await checkPhaseAccess(2, licenseValidator, context, { quiet: true });
```

This ensures the chat participant's in-chat "Pro Required" message and button are displayed instead of a modal dialog.

The "Upgrade to Pro" button already triggers `specflow.showUpgradeModal` command, which will show the proper upgrade modal when clicked.
  </action>
  <verify>npm run compile succeeds</verify>
  <done>Chat participant uses quiet mode for license check</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] Extension loads in Extension Development Host (F5)
- [ ] @specflow shows "SpecFlow Pro Required" message IN CHAT (not modal)
- [ ] Chat shows bullet points about Pro features
- [ ] Chat shows "Upgrade to Pro" button
- [ ] No modal dialog appears automatically when sending message
- [ ] Clicking "Upgrade to Pro" button triggers the wallet connect flow
</verification>

<success_criteria>
- UAT-002 from 02-01-ISSUES.md addressed
- License check no longer shows blocking modal
- Chat participant displays upgrade prompt in-stream
- Follow-up suggestions appear after response
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/02-chat-participant/02-01-FIX2-SUMMARY.md`
</output>
