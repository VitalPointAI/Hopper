---
phase: 02-chat-participant
plan: 01-FIX
type: fix
---

<objective>
Fix 1 UAT issue from plan 02-01.

Source: 02-01-ISSUES.md
Priority: 1 blocker, 0 major, 0 minor
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md

**Issues being fixed:**
@.planning/phases/02-chat-participant/02-01-ISSUES.md

**Original plan for reference:**
@.planning/phases/02-chat-participant/02-01-PLAN.md

**Key source files:**
@src/extension.ts
@src/chat/specflowParticipant.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add try-catch around chat participant registration</name>
  <files>src/extension.ts</files>
  <action>
Wrap the chat participant registration in a try-catch block to prevent crashes during activation if the Chat API has issues:

```typescript
// Create and register the @specflow chat participant
try {
  const chatParticipant = createSpecflowParticipant(context, licenseValidator);
  context.subscriptions.push(chatParticipant);
  console.log('SpecFlow chat participant registered');
} catch (err) {
  console.error('Failed to register chat participant:', err);
  // Don't crash - chat participant is optional, extension can still work
}
```

This ensures that if `vscode.chat.createChatParticipant()` throws (e.g., API not available in this VSCode version), the extension still activates and other features work.
  </action>
  <verify>npm run compile succeeds</verify>
  <done>Chat participant registration wrapped in try-catch with error logging</done>
</task>

<task type="auto">
  <name>Task 2: Add onChatParticipant activation event</name>
  <files>package.json</files>
  <action>
Add explicit activation event for the chat participant to package.json activationEvents array:

```json
"activationEvents": [
  "onChatParticipant:specflow.chat-participant"
]
```

While VSCode should auto-register this, being explicit ensures the extension activates when the chat participant is invoked.

Also verify the `engines.vscode` is compatible with Chat Participants API (requires ^1.93.0 minimum, we have ^1.104.0 which is fine).
  </action>
  <verify>npm run compile succeeds, package.json is valid JSON</verify>
  <done>activationEvents includes onChatParticipant entry</done>
</task>

<task type="auto">
  <name>Task 3: Add defensive checks in createSpecflowParticipant</name>
  <files>src/chat/specflowParticipant.ts</files>
  <action>
Add defensive checks at the start of createSpecflowParticipant to verify the Chat API is available:

```typescript
export function createSpecflowParticipant(
  context: vscode.ExtensionContext,
  licenseValidator: LicenseValidator
): vscode.Disposable {
  // Verify Chat API is available
  if (!vscode.chat || !vscode.chat.createChatParticipant) {
    console.warn('VSCode Chat API not available - chat participant disabled');
    // Return a no-op disposable
    return { dispose: () => {} };
  }

  // ... rest of function
```

This prevents crashes on older VSCode versions that don't support the Chat Participants API.
  </action>
  <verify>npm run compile succeeds with no TypeScript errors</verify>
  <done>createSpecflowParticipant has defensive API availability check</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] Extension loads in Extension Development Host (F5) without crashing
- [ ] If Chat API works: @specflow appears in chat
- [ ] If Chat API fails: Extension still activates, error logged to console
- [ ] Other extension features (NEAR AI models, license commands) still work
</verification>

<success_criteria>
- All UAT issues from 02-01-ISSUES.md addressed
- Extension no longer crashes on activation
- Chat participant registration fails gracefully if API unavailable
- Tests pass (if any)
- Ready for re-verification
</success_criteria>

<output>
After completion, create `.planning/phases/02-chat-participant/02-01-FIX-SUMMARY.md`
</output>
