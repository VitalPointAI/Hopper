---
phase: 07-planning-depth
plan: 01
type: feature
subsystem: config
requires:
  - phase: 06-04
    provides: Security review complete
provides:
  - HopperConfig type with depth and mode settings
  - ConfigManager for loading/saving .planning/config.json
  - Default configuration values
affects: [newProject, executePlan]
---

# Plan 07-01: Configuration Types and Manager

## Objective

<objective>
Create the configuration infrastructure for planning depth (quick/standard/comprehensive) and execution mode (yolo/guided/manual) settings. This includes TypeScript types, a ConfigManager class for persistence, and sensible defaults.
</objective>

## Tasks

<tasks>
<task type="auto" id="1">
  <name>Create configuration types</name>
  <files>src/config/types.ts</files>
  <action>
Create src/config/types.ts with:
- PlanningDepth type: 'quick' | 'standard' | 'comprehensive'
- ExecutionMode type: 'yolo' | 'guided' | 'manual'
- HopperConfig interface with:
  - planningDepth: PlanningDepth (default: 'standard')
  - executionMode: ExecutionMode (default: 'guided')
  - timestamps: createdAt, updatedAt (ISO strings)
- DEFAULT_CONFIG constant with standard/guided defaults
- Include JSDoc comments explaining each depth level:
  - quick: Minimal detail, fast to generate, good for simple projects
  - standard: Balanced detail, suitable for most projects
  - comprehensive: Maximum detail, thorough analysis, complex projects
- Include JSDoc comments explaining each execution mode:
  - yolo: No confirmations, auto-execute everything
  - guided: Confirm at checkpoints only
  - manual: Confirm every task before execution
  </action>
  <verify>File exists with all types, interfaces, and default constant</verify>
  <done>TypeScript compiles without errors</done>
</task>

<task type="auto" id="2">
  <name>Create ConfigManager class</name>
  <files>src/config/configManager.ts</files>
  <action>
Create src/config/configManager.ts with ConfigManager class:
- Constructor takes workspaceUri: vscode.Uri
- CONFIG_PATH = '.planning/config.json' (relative to workspace)
- loadConfig(): Promise<HopperConfig> - loads config or returns DEFAULT_CONFIG if missing
- saveConfig(config: HopperConfig): Promise<void> - saves config with updatedAt timestamp
- updateConfig(partial: Partial<HopperConfig>): Promise<HopperConfig> - merge and save
- resetConfig(): Promise<HopperConfig> - reset to defaults with new timestamps
- configExists(): Promise<boolean> - check if config file exists
- Use vscode.workspace.fs for file operations
- Handle JSON parse errors gracefully (return defaults with warning log)
  </action>
  <verify>ConfigManager can load/save config.json</verify>
  <done>Class exports correctly with all methods implemented</done>
</task>

<task type="auto" id="3">
  <name>Create config module index</name>
  <files>src/config/index.ts</files>
  <action>
Create src/config/index.ts that re-exports:
- All types from './types'
- ConfigManager class from './configManager'
This follows the established pattern in src/chat/generators/index.ts
  </action>
  <verify>Module exports all config utilities</verify>
  <done>Import { HopperConfig, ConfigManager } from './config' works</done>
</task>

<task type="checkpoint:human-verify" id="4">
  <what-built>Configuration infrastructure with types and persistence manager</what-built>
  <how-to-verify>
    1. Check src/config/types.ts has all types and defaults
    2. Check src/config/configManager.ts has all CRUD methods
    3. Run npm run compile to verify no type errors
  </how-to-verify>
  <resume-signal>Mark approved to continue</resume-signal>
</task>
</tasks>

## Verification

<verification>
- [ ] npm run compile succeeds
- [ ] src/config/types.ts exports HopperConfig, PlanningDepth, ExecutionMode, DEFAULT_CONFIG
- [ ] src/config/configManager.ts exports ConfigManager class
- [ ] src/config/index.ts re-exports all config utilities
- [ ] JSDoc comments explain each depth and mode option
</verification>

## Success Criteria

<success-criteria>
- Configuration types are complete and well-documented
- ConfigManager can load/save .planning/config.json
- Default configuration is sensible (standard/guided)
- Module follows established codebase patterns
</success-criteria>
