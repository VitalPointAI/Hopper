---
phase: 09-useability-and-skills
plan: 03
type: execute
---

<objective>
Enhance chat participant to recognize and act on user's direct instructions instead of redirecting to workflow commands.

Purpose: When the user speaks to Hopper in general chat with action-oriented input ("fix this", "add that", "update the file"), Hopper should acknowledge and act — not redirect to /help or /progress. The user is the boss.
Output: Responsive chat participant that detects intent and executes direct requests.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./09-03-SUMMARY.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-useability-and-skills/09-CONTEXT.md
@.planning/phases/09-useability-and-skills/09-01-SUMMARY.md
@.planning/phases/09-useability-and-skills/09-02-SUMMARY.md

# Key files to modify:
@src/chat/hopperParticipant.ts

# Prior context:
- Current general chat just passes prompt to model with minimal context
- User expects direct action, not workflow redirection
- Tools are available via request.toolInvocationToken
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add intent detection for action-oriented user input</name>
  <files>src/chat/hopperParticipant.ts</files>
  <action>
Add intent detection to recognize when the user wants direct action:

1. Create intent detection patterns at top of file:
   ```typescript
   const ACTION_INTENT_PATTERNS = [
     /^(fix|update|change|modify|edit|add|remove|delete|create|refactor)\s/i,
     /^(can you|please|could you)\s+(fix|update|change|add|remove|create)/i,
     /^(make|do|run|execute|implement)\s/i,
     /(fix this|do this|update this|change this)/i,
     /you (missed|forgot|skipped|didn't)/i,
   ];

   function detectActionIntent(prompt: string): boolean {
     return ACTION_INTENT_PATTERNS.some(pattern => pattern.test(prompt.trim()));
   }
   ```

2. In the handler, after checking for slash commands, add intent detection:
   ```typescript
   // Check for action intent in general chat
   const hasActionIntent = detectActionIntent(request.prompt);
   ```

3. If hasActionIntent is true, enhance the system prompt to enable tool use:
   - Add instruction to acknowledge the request first
   - Enable tools for file operations
   - Tell the model to execute the action, not describe it

4. Track intent detection in output channel:
   - `logger.info(`Action intent detected: "${request.prompt.slice(0, 50)}..."`)`

Do NOT break existing behavior for questions or general conversation — only intercept clear action requests.
  </action>
  <verify>
- Build succeeds: `npm run compile`
- Test "fix this bug" in chat — should detect action intent
- Test "what is this?" in chat — should NOT detect action intent
- Output channel shows intent detection logs
  </verify>
  <done>
- ACTION_INTENT_PATTERNS defined with common action phrases
- detectActionIntent helper function exists
- Intent detection integrated into chat handler
- Logging of detected intents
- Non-action prompts handled normally
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement direct action execution with acknowledgment</name>
  <files>src/chat/hopperParticipant.ts</files>
  <action>
When action intent is detected, execute directly with tools:

1. Update the handler's action intent branch:
   ```typescript
   if (hasActionIntent) {
     // Acknowledge immediately
     stream.markdown('**Got it.** Working on your request...\n\n');

     // Build action-focused prompt
     const actionPrompt = `You are Hopper, executing a direct user request.

The user said: "${request.prompt}"

INSTRUCTIONS:
1. Acknowledge what you're going to do in one sentence
2. Execute the action using available tools (file edits, terminal commands, etc.)
3. Report what you did when complete

Do NOT redirect to workflow commands. Do NOT ask clarifying questions unless absolutely necessary.
The user wants action, not advice.

Project context:
${projectContext.hasPlanning ? formatContextForPrompt(projectContext) : 'No project context available.'}`;

     const messages = [
       vscode.LanguageModelChatMessage.User(actionPrompt)
     ];

     // Execute with tools enabled
     // ... (similar to executePlan's executeWithTools pattern)
   }
   ```

2. Enable tool access for action execution:
   - Get available tools: `const tools = vscode.lm.tools.filter(...)`
   - Use the tool orchestration pattern from executePlan.ts
   - Pass request.toolInvocationToken for file operations

3. After execution:
   - Log completion: `logger.success(`Direct action completed: "${request.prompt.slice(0, 50)}..."`)`
   - Show in chat: completion message from model

4. On error:
   - Log error: `logger.error(`Direct action failed: ${error.message}`)`
   - Show in chat: error with suggestion to use specific command

Keep the existing model.sendRequest flow for non-action prompts (questions, conversation).
  </action>
  <verify>
- Build succeeds: `npm run compile`
- Test "add a comment to function X" — should execute file edit
- Test "what does this function do?" — should answer normally (no tool use)
- Output channel shows action execution logs
  </verify>
  <done>
- Action intent branch executes with tools
- Immediate acknowledgment: "Got it. Working on..."
- Tool orchestration integrated (from executePlan pattern)
- Completion logged to output channel
- Errors handled gracefully
- Non-action prompts still work normally
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] Action-oriented prompts execute directly with tools
- [ ] Non-action prompts handled normally (conversation, questions)
- [ ] Acknowledgment shown before execution: "Got it. Working on..."
- [ ] Output channel logs intent detection and action completion
- [ ] No regressions in slash command handling
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- No TypeScript errors
- Action intent detection works for common phrases
- Direct execution works with tool access
- User gets immediate acknowledgment
</success_criteria>

<output>
After completion, create `.planning/phases/09-useability-and-skills/09-03-SUMMARY.md`
</output>
