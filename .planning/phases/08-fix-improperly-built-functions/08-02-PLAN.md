---
phase: 08-fix-improperly-built-functions
plan: 02
type: execute
---

<objective>
Enhance test instruction quality and add explicit pause/resume UX to /verify-work.

Purpose: Make verification feel collaborative with clear, actionable test instructions and explicit pause capability.
Output: Test instructions tell user exactly what to do; pause button available during testing.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-fix-improperly-built-functions/08-CONTEXT.md
@.planning/phases/08-fix-improperly-built-functions/08-01-SUMMARY.md

**Key files:**
@src/chat/commands/verifyWork.ts

**From 08-CONTEXT.md:**
- Test instructions are insufficient - user doesn't know specific steps
- No way to pause explicitly - user has to click away or press Escape

**Prior plan (08-01) delivered:**
- State persistence via globalState
- Non-blocking QuickPick that pauses on dismiss
- Resume flow when state exists
</context>

<tasks>

<task type="auto">
  <name>Task 1: Improve LLM prompt for detailed test instructions</name>
  <files>src/chat/commands/verifyWork.ts</files>
  <action>
Update generateTestChecklist function's LLM prompt to generate more actionable instructions.

Current prompt produces vague tests like "Verify: Set up Node.js/Express backend with security middleware".

New prompt should require:
1. **Specific action** - What exactly to do (run command, click button, navigate to URL)
2. **Exact steps** - Numbered steps to reproduce
3. **Expected outcome** - What success looks like (specific text, behavior, response)
4. **How to confirm** - Observable verification (console output, UI state, network response)

Updated prompt template:
```
Generate detailed manual test instructions for verifying these deliverables.

## Deliverables
${accomplishments}

## Requirements for EACH test instruction:
1. ACTION: Start with a verb (Run, Click, Navigate, Type, Open)
2. STEPS: Include specific commands, URLs, or UI paths
3. EXPECTED: Describe exactly what should happen
4. CONFIRM: How to verify it worked (what to see/check)

## Format
Each test must be 2-4 sentences with concrete details.

BAD: "Verify the login works"
GOOD: "Navigate to /login, enter email 'test@example.com' and password 'test123', click Submit. Expected: Redirect to /dashboard with 'Welcome' message. Confirm: URL changes to /dashboard and greeting shows in top-right."

BAD: "Check the API endpoint"
GOOD: "Run 'curl -X POST http://localhost:3000/api/users -H \"Content-Type: application/json\" -d '{\"name\":\"Test\"}'' in terminal. Expected: 201 response with JSON containing id and name fields. Confirm: Response body shows {\"id\": \"...\", \"name\": \"Test\"}."
```

This produces tests users can actually follow step-by-step.
  </action>
  <verify>Run /verify-work on any plan with a SUMMARY.md, confirm generated tests include specific commands/URLs/steps</verify>
  <done>Generated tests are detailed with actions, steps, expected outcomes</done>
</task>

<task type="auto">
  <name>Task 2: Add explicit Pause button to test picker</name>
  <files>src/chat/commands/verifyWork.ts</files>
  <action>
Add a "Pause" option to the test result QuickPick so users can explicitly pause.

Update the QuickPick options in runInteractiveTests:
```typescript
const options = [
  { label: '$(pass) Pass', description: 'Feature works as described', value: 'pass' as const },
  { label: '$(error) Fail', description: 'Feature does not work', value: 'fail' as const },
  { label: '$(warning) Partial', description: 'Works but has issues', value: 'partial' as const },
  { label: '$(debug-step-over) Skip', description: 'Cannot test right now', value: 'skip' as const },
  { label: '$(debug-pause) Pause', description: 'Save progress and continue later', value: 'pause' as const }
];
```

Handle "pause" selection:
1. Save current state with pausedAt timestamp
2. Display friendly message: "Verification paused at test X of Y. Run /verify-work to resume."
3. Return early from runInteractiveTests (don't mark remaining as skipped)
4. Let handleVerifyWork complete normally (resume logic already handles pickup)

This gives users explicit control to pause without relying on Escape/click-away.
  </action>
  <verify>Run /verify-work, select "Pause" on any test, confirm state saved and resume message shown</verify>
  <done>Pause button works, explicitly saves state, friendly resume message</done>
</task>

<task type="auto">
  <name>Task 3: Show progress indicator and help during testing</name>
  <files>src/chat/commands/verifyWork.ts</files>
  <action>
Enhance the testing UX with better progress visibility and inline help.

1. Update QuickPick title to show progress:
   ```typescript
   picker.title = `Test ${i + 1}/${testItems.length}: Select result`;
   ```

2. Add help text to QuickPick placeholder:
   ```typescript
   picker.placeholder = 'Read instructions above, then select result. Choose "Pause" to save and continue later.';
   ```

3. In the chat stream, before each test, show:
   ```markdown
   ---

   ### Test ${i + 1} of ${testItems.length}

   **Instructions:**
   ${testItem}

   **Actions:** Select result in the picker above, or choose "Pause" to save progress.
   ```

4. If resuming, show context:
   ```markdown
   ## Resuming Verification

   **Previously completed:** ${completedCount} of ${totalCount} tests
   **Continuing from:** Test ${nextIndex + 1}

   Prior results:
   ${priorResults.map(r => `- ${statusEmoji} ${r.feature.substring(0, 50)}...`).join('\n')}
   ```

This keeps users oriented and aware of their options throughout the flow.
  </action>
  <verify>Run /verify-work, confirm progress shows in picker title, placeholder includes pause hint, resume shows prior progress</verify>
  <done>Progress visible in picker, help text present, resume shows context</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run compile` succeeds without errors
- [ ] Generated test instructions are detailed and actionable
- [ ] Pause button explicitly saves state
- [ ] Progress indicator shows current/total in picker
- [ ] Resume shows what was already completed
- [ ] Full verification flow still works end-to-end
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Test instructions are specific and actionable
- Pause/resume flow is clear and user-friendly
- Phase 8 complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-fix-improperly-built-functions/08-02-SUMMARY.md`
</output>
